<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>å¥¶èŒ¶è‰²æ–‡é’è®€æ›¸è¨ˆç•«</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: "Noto Sans TC", sans-serif;
        background: #f4e9d8; /* å¥¶èŒ¶è‰² */
        margin: 0;
        padding: 20px;
    }

    h1, h2 {
        color: #4b3427;
    }

    .card {
        background: #fff;
        padding: 20px;
        margin: 15px 0;
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }

    .btn {
        display: inline-block;
        padding: 10px 18px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
        transition: 0.2s;
        color: white;
    }

    /* å¤§åœ°è‰²ç³»æŒ‰éˆ• */
    .btn-earth { background: #a0826a; }
    .btn-earth:hover { background: #8d6f58; }

    .btn-green { background: #6d8f6d; }
    .btn-green:hover { background: #5b7c5b; }

    .btn-red { background: #b76b5e; }
    .btn-red:hover { background: #9c594e; }

    input, select {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #c8b6a6;
        margin-bottom: 12px;
        outline: none;
    }

    /* Modal */
    .modal-bg {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        display: none;
        align-items: center;
        justify-content: center;
    }
    .modal {
        background: white;
        padding: 25px;
        width: 90%;
        max-width: 350px;
        border-radius: 12px;
        text-align: center;
    }
</style>
</head>
<body>

<h1>ğŸ“š å¥¶èŒ¶æ–‡é’è®€æ›¸è¨ˆç•«</h1>

<div class="card">
    <h2>ç™»å…¥ / ä½¿ç”¨è€…è³‡æ–™</h2>
    <button class="btn btn-earth" onclick="openLogin()">ç™»å…¥</button>
    <p id="loginStatus">å°šæœªç™»å…¥</p>
</div>

<div class="card">
    <h2>æ–°å¢è®€æ›¸é …ç›®</h2>
    <input id="subject" placeholder="ç§‘ç›®ï¼ˆä¾‹å¦‚ï¼šæ•¸å­¸ï¼‰">
    <input id="hours" type="number" placeholder="æ™‚æ•¸ï¼ˆå°æ™‚ï¼‰">
    <button class="btn btn-green" onclick="addStudy()">åŠ å…¥è¨ˆç•«</button>
</div>

<div class="card">
    <h2>ğŸ“… å·²æ’ç¨‹</h2>
    <div id="list"></div>
</div>

<div class="card">
    <h2>ğŸ“Š ä¸€é€±ç´¯ç©æ™‚æ•¸</h2>
    <p id="weeklyHours">0 å°æ™‚</p>
</div>

<div class="card">
    <h2>ğŸ’¾ åŒ¯å‡º / åŒ¯å…¥</h2>
    <button class="btn btn-earth" onclick="exportData()">åŒ¯å‡º JSON</button>
    <input type="file" id="importFile" style="display:none;" onchange="importData(event)">
    <button class="btn btn-earth" onclick="document.getElementById('importFile').click()">åŒ¯å…¥ JSON</button>
</div>

<!-- Modal -->
<div class="modal-bg" id="modalBg">
    <div class="modal">
        <p id="modalMsg"></p>
        <button class="btn btn-earth" onclick="closeModal()">OK</button>
    </div>
</div>

<script>
/* -------------------- Modal -------------------- */
function showMsg(msg){
    document.getElementById("modalMsg").innerText = msg;
    document.getElementById("modalBg").style.display = "flex";
}
function closeModal(){
    document.getElementById("modalBg").style.display = "none";
}

/* -------------------- Loginï¼ˆç´”å‰ç«¯å‡ç™»å…¥ï¼‰ -------------------- */
let user = localStorage.getItem("userName") || "";

function openLogin(){
    const name = prompt("è«‹è¼¸å…¥åç¨±ï¼š");
    if(!name) return;

    user = name;
    localStorage.setItem("userName", user);

    showMsg("æ­¡è¿ä½ ï¼Œ" + user + "ï¼");
    updateLoginStatus();

    setTimeout(() => askStrengthWeak(), 500);
}

function updateLoginStatus(){
    if(user){
        document.getElementById("loginStatus").innerText = "ç™»å…¥ä¸­ï¼š" + user;
    }else{
        document.getElementById("loginStatus").innerText = "å°šæœªç™»å…¥";
    }
}

function askStrengthWeak(){
    const strong = prompt("ä½ çš„å¼·ç§‘æ˜¯ï¼Ÿ");
    const weak = prompt("ä½ çš„å¼±ç§‘æ˜¯ï¼Ÿ");

    if(strong) localStorage.setItem("strong", strong);
    if(weak) localStorage.setItem("weak", weak);

    showMsg("å·²ç´€éŒ„ä½ çš„å¼·ç§‘èˆ‡å¼±ç§‘ï¼");
}

/* -------------------- Study Data -------------------- */
let studyList = JSON.parse(localStorage.getItem("studyList") || "[]");

function addStudy(){
    const subject = document.getElementById("subject").value;
    const hours = parseInt(document.getElementById("hours").value);

    if(!subject || !hours){
        showMsg("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™ï¼");
        return;
    }

    studyList.push({ subject, hours });
    localStorage.setItem("studyList", JSON.stringify(studyList));

    renderList();
    sumWeekly();
    showMsg("å·²åŠ å…¥ï¼");
}

function renderList(){
    const list = document.getElementById("list");
    list.innerHTML = "";

    studyList.forEach((item, i)=>{
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML =
            `<b>${item.subject}</b> - ${item.hours} å°æ™‚<br>
             <button class='btn btn-red' onclick="del(${i})">åˆªé™¤</button>`;
        list.appendChild(div);
    });
}

function del(i){
    studyList.splice(i,1);
    localStorage.setItem("studyList", JSON.stringify(studyList));
    renderList();
    sumWeekly();
}

/* -------------------- Weekly Hours -------------------- */
function sumWeekly(){
    let total = 0;
    studyList.forEach(s => total += s.hours);
    document.getElementById("weeklyHours").innerText = total + " å°æ™‚";
}

/* -------------------- Export JSON -------------------- */
function exportData(){
    const data = {
        user,
        strong: localStorage.getItem("strong"),
        weak: localStorage.getItem("weak"),
        studyList
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "study-data.json";
    a.click();
}

/* -------------------- Import JSON -------------------- */
function importData(e){
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(evt){
        const data = JSON.parse(evt.target.result);

        user = data.user || "";
        localStorage.setItem("userName", user);

        if(data.strong) localStorage.setItem("strong", data.strong);
        if(data.weak) localStorage.setItem("weak", data.weak);

        studyList = data.studyList || [];
        localStorage.setItem("studyList", JSON.stringify(studyList));

        updateLoginStatus();
        renderList();
        sumWeekly();

        showMsg("è³‡æ–™åŒ¯å…¥æˆåŠŸï¼");
    };
    reader.readAsText(file);
}

/* Init */
updateLoginStatus();
renderList();
sumWeekly();

</script>
</body>
</html>
